# –ú–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∞ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`HealthPredictor`)

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `HealthPredictor` —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∞ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (–ê–î, –ß–°–°, SpO2, –°–ù–°, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ) –ø–æ–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º **–º–µ—Ç–µ–æ—Ñ–∞–∫—Ç–æ—Ä–æ–≤**.

–¶–µ–ª—å:
- üß† **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å** —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ **7 –¥–Ω–µ–π** –≤–ø–µ—Ä—ë–¥
- üéØ **–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å** –º–æ–¥–µ–ª—å –ø–æ–¥ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–±—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å**
- üßÆ **–û—Ü–µ–Ω–∏—Ç—å** —Ä–∏—Å–∫–∏ (–≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è, –≥–∏–ø–æ—Ç–æ–Ω–∏—è, –∫–∏—Å–ª–æ—Ä–æ–¥, –ø—Å–∏—Ö–æ—Å–æ–º–∞—Ç–∏–∫–∞)
- üìä **–í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å** –¥–∏–Ω–∞–º–∏–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å: `tensor_model_fixed_with_climate_norms`

- **–í—Ö–æ–¥**: `df_meteo`, `user_profile`, `response_coeffs`, `start_values`
- **–í—ã—Ö–æ–¥**: —Å–ª–æ–≤–∞—Ä—å —Å `'ad_pred'`, `'pulse_pred'`, `'spo2_pred'`, `'sns_index'`, `'mood'`, `'arousal'`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –∏–º–ø–µ—Ä–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å –∏–∑ `v5.1`, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è –¥–∏–Ω–∞–º–∏–∫—É —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤: `HealthPredictor`

- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç**: `scikit-learn.Ridge` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `response_coeffs` –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í—Ö–æ–¥**: `user_id`, `lat`, `lon`, `meteo_forecast_df`
- **–í—ã—Ö–æ–¥**: `response_coeffs` (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∏–ª–∏ —Å—Ä–µ–¥–Ω–∏–µ)

### 3. –≠–≤–æ–ª—é—Ü–∏—è —Ç–∏–ø–∞: `evolve_s`, `align_s_with_p`

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –¥–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π —Ç–∏–ø–æ–≤ (`healthy`, `hypertension`, `hypotension`...) –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º —Å—Ç—Ä–µ—Å—Å–∞ –∏ —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- **–í—Ö–æ–¥**: `s_current`, `stress_index`, `phys_dev`, `days_elapsed`, `age_normalized`
- **–í—ã—Ö–æ–¥**: `s_new` (–Ω–æ–≤—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏)

---

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

- `user_id` (int, optional): –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `lat`, `lon` (float): –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `health_logs` (–∏–∑ `local_db_meteo`): –ê–î, –ß–°–°, SpO2, —Å–∏–º–ø—Ç–æ–º—ã (–º–∏–≥—Ä–µ–Ω—å, —Å–æ–Ω–ª–∏–≤–æ—Å—Ç—å –∏ —Ç.–¥.)

### 2. –ú–µ—Ç–µ–æ-–¥–∞–Ω–Ω—ã–µ

- `meteo_forecast_df` (pd.DataFrame): –ø–æ—á–∞—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ 7 –¥–Ω–µ–π (168 —Å—Ç—Ä–æ–∫)
  - `time`: timestamp
  - `msl_hPa`, `t_c`, `rh`, `wind_speed`, `cape`, `shortwave_radiation`, `N_turb`, `max_front_grad`, `max_wind_shear`
  - `dP_dt`, `dT_dt`: –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã

### 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏

- `MU`: –º–∞—Ç—Ä–∏—Ü–∞ –∞—Ç—Ç—Ä–∞–∫—Ç–æ—Ä–æ–≤ —Ç–∏–ø–æ–≤ (–∑–¥–æ—Ä–æ–≤—ã–π, –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏–∫ –∏ —Ç.–¥.)
- `W_METEO`, `W_PHYS`, `W_AGE`: –º–∞—Ç—Ä–∏—Ü—ã –≤–ª–∏—è–Ω–∏—è
- `ALPHA`, `BETA`, `GAMMA`: –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —ç–≤–æ–ª—é—Ü–∏–∏

---

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 1. –ü—Ä–æ–≥–Ω–æ–∑

- `p_hourly_history` (np.ndarray): –∏—Å—Ç–æ—Ä–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ê–î, –ß–°–°, SpO2, w_neuro, w_depr, w_cardio, w_stress, w_age) –ø–æ —á–∞—Å–∞–º
- `s_hourly_history` (np.ndarray): –∏—Å—Ç–æ—Ä–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π —Ç–∏–ø–æ–≤ –ø–æ —á–∞—Å–∞–º
- `stress_hourly_history` (np.ndarray): –∏–Ω–¥–µ–∫—Å –º–µ—Ç–µ–æ-—Å—Ç—Ä–µ—Å—Å–∞ –ø–æ —á–∞—Å–∞–º
- `phys_dev_hourly_history` (np.ndarray): —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º
- `sns_hourly`, `mood_hourly`, `arousal_hourly` (np.ndarray): –°–ù–°, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ –ø–æ —á–∞—Å–∞–º

### 2. –†–∏—Å–∫–∏

- `risks` (list): —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å `timestamp` –∏ `risks` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'hypertensive'`, `'cardio'`, `'oxygen'`, `'psycho'`)

### 3. –ì—Ä–∞—Ñ–∏–∫

- `FILE_PATH`: –ø—É—Ç—å –∫ `impact_forecast_{user_id}_{lat}_{lon}.png`

---

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

### 1. `impact_forecast_script.py`

- **–í—ã–∑—ã–≤–∞–µ—Ç**: `HealthPredictor.get_response_coeffs(...)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `response_coeffs`
- **–ó–∞–ø—É—Å–∫–∞–µ—Ç**: `predict_7day_health_state(...)` —Å —ç—Ç–∏–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
- **–í—ã–≤–æ–¥–∏—Ç**: `EVENT_TYPE:task_result`, `RESULT_TYPE:report`, `MESSAGE`, `FILE_PATH`, `RISKS`

### 2. `process_manager.py`

- **–ó–∞–ø—É—Å–∫–∞–µ—Ç**: `impact_forecast_script.py` —á–µ—Ä–µ–∑ `enqueue_script`
- **–ü–æ–ª—É—á–∞–µ—Ç**: `EVENT_TYPE:task_result` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤ `event_bus`

### 3. `api_client.py`

- **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç**: `get_weather_data`, `get_gfs_turbulence_data_sync` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–µ–æ-–¥–∞–Ω–Ω—ã—Ö

### 4. `local_db_meteo.py`

- **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç**: `get_user_health_log`, `get_user_health_stats` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 5. `local_db_weather.py`

- **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç**: `get_cached_weather` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–µ–æ-–¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Ä–µ–º–µ–Ω–∏

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏—è: `HealthPredictor.get_response_coeffs(...)`

```python
from scripts.meteo._processes.health_predictor import HealthPredictor

predictor = HealthPredictor()
R = predictor.get_response_coeffs(
    user_id=123,  # –∏–ª–∏ None
    lat=55.75,
    lon=37.62,
    meteo_forecast_df=meteo_df  # pd.DataFrame —Å –º–µ—Ç–µ–æ-–¥–∞–Ω–Ω—ã–º–∏
)
# R = {'ad_dp': ..., 'pulse_dp': ..., ...} - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã