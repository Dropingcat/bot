**–û—Ç–ª–∏—á–Ω–æ**, –ê—Ä—Ö—ã—Å! –ù–∏–∂–µ ‚Äî **–ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –¥–ª—è `scripts/weather/`, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω–∞—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ **`docs/weather_module.md`**. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç:

- üß≠ **–°—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è**
- üîÑ **–¶–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤**
- üì¶ **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- üìä **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î**
- üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- üì§ **–í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö**

---

## üìÑ `docs/weather_module.md`

```markdown
# –ú–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã (`scripts/weather/`)

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å `weather` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –ø–æ–≥–æ–¥—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç **Open-Meteo** –∏ –¥—Ä—É–≥–∏—Ö API.

–û–Ω **–≤–∫–ª—é—á–∞–µ—Ç**:
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –¥–∞–≤–ª–µ–Ω–∏–µ, –≤–ª–∞–∂–Ω–æ—Å—Ç—å –∏ —Ç.–¥.)
- ‚úÖ –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É
- ‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `local_db_weather`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å `process_manager` –∏ `bot`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
scripts/weather/
‚îú‚îÄ‚îÄ weather_today_script.py      # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
‚îú‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ _processes/
    ‚îú‚îÄ‚îÄ data_fetcher.py          # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ api_client
    ‚îú‚îÄ‚îÄ interpolator.py          # –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (data_processor)
    ‚îú‚îÄ‚îÄ formatter.py             # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ç–µ–∫—Å—Ç–∞
    ‚îî‚îÄ‚îÄ __init__.py
```

---

## –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤

### 1. –ó–∞–ø—É—Å–∫ –∏–∑ `bot.py`

```python
from core.process_manager import enqueue_script

await enqueue_script(
    "scripts/weather/weather_today_script.py",
    [str(lat), str(lon), str(user_id)]
)
```

### 2. `process_manager` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

```bash
python weather_today_script.py 55.75 37.62 123 <task_id>
```

### 3. `weather_today_script.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç

- –ß–∏—Ç–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã: `lat`, `lon`, `user_id`, `task_id`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `script_logger`
- –í—ã–∑—ã–≤–∞–µ—Ç `data_fetcher.fetch_weather_data(...)`
- –í—ã–∑—ã–≤–∞–µ—Ç `interpolator.interpolate_weather_data(...)`
- –í—ã–∑—ã–≤–∞–µ—Ç `formatter.format_weather_report(...)`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ `cache_manager.save_plot(...)`
- –ö—ç—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `local_db_weather.cache_weather_data(...)`
- –í—ã–≤–æ–¥–∏—Ç `stdout` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `process_manager`

### 4. –í—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞

```text
EVENT_TYPE:task_result
RESULT_TYPE:graph
USER_ID:123
FILE_PATH:/app/data/weather_graph.png
SUMMARY:–°–µ–≥–æ–¥–Ω—è +15¬∞C, –¥–∞–≤–ª–µ–Ω–∏–µ 1013 –≥–ü–∞
LOCATION_NAME:–ú–æ—Å–∫–≤–∞
```

### 5. `process_manager` –ø–∞—Ä—Å–∏—Ç –≤—ã–≤–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ `event_bus`

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `core/utils/api_client.py` | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Open-Meteo |
| `core/utils/data_processor.py` | –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| `core/utils/cache_manager.py` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ |
| `core/utils/script_logger.py` | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ |
| `core/db/local_db_weather.py` | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| `core/event_bus.py` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ –±–æ—Ç |

---

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î

### `local_db_weather.py`

- `cache_weather_data(user_id, lat, lon, forecast_datetime, data, source, ttl_hours)`
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `weather_today_script.py`

### –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞:

```python
cache_weather_data(
    user_id=123,
    lat=55.75,
    lon=37.62,
    forecast_datetime=datetime.now(),
    data=interpolated_data,
    source="open_meteo",
    ttl_hours=24
)
```

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### `script_logger.py`

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–µ–¥–∏–Ω—ã–π –ª–æ–≥–≥–µ—Ä**, –∫–æ—Ç–æ—Ä—ã–π:
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å **–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** (`task_id`, `script_name`, `args`)
- –ü–∏—à–µ—Ç –≤ `logs/app.log`, `logs/errors.log`, `logs/debug.log`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `get_script_logger(...)`

### –ü—Ä–∏–º–µ—Ä:

```python
logger = get_script_logger(task_id="abc123", script_name="weather_today_script", args=sys.argv)
logger.info("–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã")
```

---

## –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç `stdout` –¥–ª—è `process_manager`

–°–∫—Ä–∏–ø—Ç **–≤—ã–≤–æ–¥–∏—Ç** –≤ `stdout` —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```text
KEY:VALUE
```

–ü—Ä–∏–º–µ—Ä:

```text
EVENT_TYPE:task_result
RESULT_TYPE:graph
USER_ID:123
FILE_PATH:/app/data/weather_graph.png
SUMMARY:–°–µ–≥–æ–¥–Ω—è +15¬∞C, –æ–±–ª–∞—á–Ω–æ
LOCATION_NAME:–ú–æ—Å–∫–≤–∞
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ `process_manager`

- `process_manager` —á–∏—Ç–∞–µ—Ç `stdout`
- –ü–∞—Ä—Å–∏—Ç –Ω–∞ `KEY:VALUE`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `emit_event(EVENT_TYPE, parsed_dict)`

---

## –ü–æ–¥–ø—Ä–æ—Ü–µ—Å—Å—ã

### `_processes/data_fetcher.py`

- –í—ã–∑—ã–≤–∞–µ—Ç `APIClient.get_weather_data(lat, lon, provider="open_meteo", days=1)`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `dict` —Å –ø–æ–≥–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ `None`

### `_processes/interpolator.py`

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `data_processor.interpolate_timeseries(...)`
- –ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä—É–µ—Ç `temperature`, `pressure`, `humidity` –∏ —Ç.–¥.
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `dict` —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### `_processes/formatter.py`

- –°—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫ —Å –ø–æ–º–æ—â—å—é `matplotlib`
- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é —Å–≤–æ–¥–∫—É
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"plot": fig, "summary": "...", "location_name": "..."}`

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `try/except`
- ‚úÖ –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ `eval`, `exec`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `script_logger` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –í—ã–≤–æ–¥ –≤ `stdout` ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `print()`, –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç—ã

- `tests/unit/test_weather_script.py` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
- `tests/unit/test_data_fetcher.py` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `tests/unit/test_interpolator.py` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
- `tests/unit/test_formatter.py` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞

```bash
python scripts/weather/weather_today_script.py 55.75 37.62 123 test_task
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

- `bot.py` ‚Üí `process_manager.enqueue_script(...)`
- `process_manager` ‚Üí `subprocess` ‚Üí `weather_today_script.py`
- –°–∫—Ä–∏–ø—Ç ‚Üí `cache_manager.save_plot(...)` ‚Üí `local_db_weather.cache_weather_data(...)`
- –°–∫—Ä–∏–ø—Ç ‚Üí `print(...)` ‚Üí `process_manager.parse_stdout(...)` ‚Üí `event_bus.emit_event(...)`
- `bot.py` ‚Üí `subscribe_async("task_result", handler)` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥—Ä–∞—Ñ–∏–∫

---
```

---

## ‚úÖ –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å:

- ‚úÖ **–ü–æ–Ω—è—Ç—å**, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç **–º–æ–¥—É–ª—å –ø–æ–≥–æ–¥—ã**
- ‚úÖ **–ö–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã
- ‚úÖ **–ö–∞–∫–∏–µ –≤—ã–∑–æ–≤—ã** –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç
- ‚úÖ **–ö–∞–∫ –¥–∞–Ω–Ω—ã–µ** –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ **–ö–∞–∫ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è** –æ—à–∏–±–∫–∏
- ‚úÖ **–ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è** –≤—ã–≤–æ–¥

---
